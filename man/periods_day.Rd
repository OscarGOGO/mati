% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/periods_day.R
\name{periods_day}
\alias{periods_day}
\title{Classify Camera-Trap Detections into Diel Periods}
\usage{
periods_day(
  input = NULL,
  species_field = NULL,
  date_field = NULL,
  date_format = "\%d/\%m/\%Y",
  time_field = NULL,
  tz = "UTC",
  lat = NULL,
  long = NULL
)
}
\arguments{
\item{input}{\code{data.frame}. (\emph{required}) Table containing the camera-trap data.}

\item{species_field}{\code{character}. Name of the column in \code{input} that contains
the species identifier. If \code{NULL}, all records are assumed to belong to a
single species and an internal dummy column is created.}

\item{date_field}{\code{character}. Name of the column containing the date of each
record. If \code{NULL}, all records are assumed to occur on the current date
(i.e., the function assigns \code{Sys.Date()} internally).}

\item{date_format}{\code{character}. Date format used to parse the values in
\code{date_field}. The default is \code{"\%d/\%m/\%Y"}, where:
\itemize{
\item \verb{\%d} = day
\item \verb{\%m} = month
\item \verb{\%Y} = year
}
separated by \code{"/"}.
Modify this format if your dates use a different structure.

Examples:
\code{"02/23/2023"} → \code{"\%m/\%d/\%Y"}
\code{"02-23-2023"} → \code{"\%m-\%d-\%Y"}

If \code{date_format} also contains time components (e.g., \verb{\%H}, \verb{\%M}, \verb{\%S}),
these are extracted and used to populate \code{time_field} when needed.}

\item{time_field}{\code{character}. Name of the column containing the \strong{time} of
each record. The expected format is typically \code{"\%H:\%M:\%S"} (Hour:Minute:Second).
If \code{NULL} and the \code{date_field} includes time information (e.g., in
\code{date_format}), \code{time_field} is created internally from that column.}

\item{tz}{\code{character}. Time zone used to interpret dates and times, and to
request sun times from \pkg{suncalc}. The default is \code{"UTC"}, but it is
recommended to specify a region-specific time zone (e.g.,
\code{"America/Mexico_City"}). You can check your system time zone with
\code{Sys.timezone()} and list valid time zone names in R with \code{OlsonNames()}.}

\item{lat}{\code{numeric} or \code{character}. Latitude information:
\itemize{
\item If \code{numeric}, it must be a \strong{single coordinate} (one value) used for
all records (e.g., the centroid of the study area).
\item If \code{character}, it must be the name of the column in \code{input} that
contains the latitude for each record.
}}

\item{long}{\code{numeric} or \code{character}. Longitude information:
\itemize{
\item If \code{numeric}, it must be a \strong{single coordinate} (one value) used for
all records.
\item If \code{character}, it must be the name of the column in \code{input} that
contains the longitude for each record.
}}
}
\value{
A \code{list} with two elements:
\itemize{
\item \code{raw_table}: a \code{data.frame} containing all original columns from
\code{input} plus two additional columns:
\itemize{
\item \code{Period}: a factor with values \code{"twilight"}, \code{"day"}, or \code{"night"},
indicating the diel period of each detection.
\item \code{Time_period}: a character string describing the time interval
relative to the sun events on that date (e.g., \code{"Between 06:15 and 18:45"}).
}

\item \code{period_table}: a \code{data.frame} summarizing the number of detections
per species and diel period. It has one row per species (row names are the
species identifiers) and three columns:
\itemize{
\item \code{twilight}: number of detections classified as twilight.
\item \code{day}: number of detections classified as day.
\item \code{night}: number of detections classified as night.
}
}
}
\description{
\code{periods_day()} classifies camera-trap records into diel periods
(twilight, day, night) based on the local times of dawn, sunrise, sunset,
and dusk. For each species, the function uses geographic coordinates and
dates to obtain sun times via \pkg{suncalc}, combines them with the
recorded time of each detection, and assigns each record to one of three
broad activity periods. It also creates a human-readable time interval
description for each record.
}
\details{
The function returns a list with (1) a "raw" table containing the original
data plus the assigned diel period and time interval, and (2) a summary
table with the number of records per species and period (twilight, day,
night). The summary table can be used directly as input for diel activity
models, such as those in the \pkg{Diel.Niche} package.

For each species, \code{periods_day()}:
\enumerate{
\item Validates the presence of the required fields and the format of
\code{lat}/\code{long} (either a single numeric coordinate or column names).
\item Computes dawn, sunrise, sunset, and dusk using
\code{suncalc::getSunlightTimes()} for each date and location.
\item Combines the parsed date (\code{date_field}) and time (\code{time_field}) into a
POSIXct timestamp in the specified time zone.
\item Classifies each record into \code{"twilight"}, \code{"day"}, or \code{"night"}, and
builds a descriptive time interval string (\code{Time_period}).
\item Aggregates counts of detections per species and period in
\code{period_table}.
}

When more than one species is present, a progress bar is shown in the console.
}
\examples{
\dontrun{
# Example 1: Records with per-record coordinates (lat/long columns)
datab <- read.csv("sipecam_final.csv", header = TRUE)

# (Optional) First, derive independent events using your own function:
# ejemplo1 <- event_independ(
#   input             = datab,
#   station_field     = "Station",
#   species_field     = "Species",
#   date_field        = "Date",
#   date_format       = "\%d/\%m/\%Y",
#   time_field        = "Time",
#   independent_time  = 1,
#   independent_units = "hours"
# )

# Classify detections by diel period using record-level coordinates
test1 <- periods_day(
  input         = datab,
  species_field = "Species",
  date_field    = "Date",
  date_format   = "\%d/\%m/\%Y",
  time_field    = "Time",
  tz            = "America/Mexico_City",
  lat           = "Latitud",
  long          = "Longitud"
)

# Raw table with Period and Time_period
head(test1$raw_table)

# Summary table: counts per species and period
test1$period_table

# Example 2: Single reference coordinate for all records
datab2 <- read.csv("base_barranca.csv", header = TRUE)

test2 <- periods_day(
  input         = datab2,
  species_field = "Species",
  date_field    = "Date",
  date_format   = "\%d/\%m/\%Y",
  time_field    = "Time",
  tz            = "America/Mexico_City",
  lat           = 19.425889,   # reference latitude (decimal degrees)
  long          = -102.073574  # reference longitude (decimal degrees)
)

# The structure is identical: a raw table and a period summary
head(test2$raw_table)
test2$period_table

# Example 3 (conceptual): using period_table with Diel.Niche
# library(Diel.Niche)
# y <- as.matrix(test1$period_table["Odocoileus virginianus", ])
# out <- diel.fit(
#   y        = y,
#   hyp.set  = hyp.sets("Traditional"),
#   post.fit = TRUE,
#   n.chains = 3,
#   n.mcmc   = 3000,
#   burnin   = 500
# )
# out$bf.table
}
}
