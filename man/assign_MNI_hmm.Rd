% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/assign_MNI_hmm.R
\name{assign_MNI_hmm}
\alias{assign_MNI_hmm}
\title{Assign a Minimum Number of Individuals (MNI) Using a Space–Time HMM}
\usage{
assign_MNI_hmm(
  data,
  station_field = NULL,
  species_col = NULL,
  date_field = NULL,
  date_format = "\%d/\%m/\%Y",
  time_field = NULL,
  tz = "UTC",
  species_filter = NULL,
  lat = NULL,
  long = NULL,
  alpha = NULL,
  alpha_sensitivity = NULL,
  dt = NULL,
  min_prob = 0.1
)
}
\arguments{
\item{data}{\code{data.frame}. Table containing the camera-trap records.}

\item{station_field}{\code{character}. Name of the column in \code{data} that uniquely
identifies each camera station. If set to \code{NULL}, all records are assumed to
originate from a single station.}

\item{species_col}{\code{character}. Name of the column containing the species
identifier. If \code{NULL}, all records are assumed to belong to the same species.}

\item{date_field}{\code{character}. Name of the column containing the \strong{date} of
each record. If set to \code{NULL}, all records are assumed to occur on the same day.}

\item{date_format}{\code{character}. Date format of the values in \code{date_field}.
The default is \code{"\%d/\%m/\%Y"}, where \verb{\%d} = day, \verb{\%m} = month, and \verb{\%Y} = year,
separated by \code{"/"}. Adjust this format according to your dataset.

Examples:
\code{"02/23/2023"} → \code{"\%m/\%d/\%Y"}
\code{"02-23-2023"} → \code{"\%m-\%d-\%Y"}}

\item{time_field}{\code{character}. Name of the column containing the \strong{time} of
each record. The expected format is always \code{"\%H:\%M:\%S"} (Hour:Minute:Second).}

\item{tz}{\code{character}. Time zone used when parsing date–time values. The
default is \code{"UTC"}, although other time zones may be specified depending on
the study region.}

\item{species_filter}{\code{character}. Optional species name used to filter
the dataset (e.g., \code{"Odocoileus virginianus"}). If \code{NULL}, all species are included.}

\item{lat}{\code{character}. Name of the column containing the latitude for each
record or station.}

\item{long}{\code{character}. Name of the column containing the longitude for each
record or station.}

\item{alpha}{\code{numeric}. Spatial scale parameter controlling the ease of
movement between cameras (spatial smoothing or movement scale, typically in meters).}

\item{alpha_sensitivity}{\code{numeric} or \code{NULL}. Optional vector of alternative
\code{alpha} values used to perform a sensitivity analysis of the MNI estimator to
changes in spatial scale. For each value in \code{alpha_sensitivity}, the function
recomputes MNI internally and produces diagnostic plots showing how MNI varies
with \code{alpha}. When this argument is not \code{NULL}, the plots also highlight the
\code{max_change_point} and \code{saturation_point} along the MNI–\code{alpha} curve.}

\item{dt}{\code{numeric}. Time-step size of the model, expressed in hours
(e.g., \code{1} for 1-hour steps).}

\item{min_prob}{\code{numeric}. Minimum probability threshold used to determine
whether a new detection is assigned to an existing individual or triggers
the creation of a new individual.}
}
\value{
A list with two elements:
\itemize{
\item \code{data_with_ids}: a \code{data.frame} with the original records plus three
additional columns: \code{indiv_id} (assigned individual identifier),
\code{prob_last_ind} (probability of assignment to the selected existing individual),
and \code{prob_new_ind} (complementary probability of creating a new individual).

\item \code{MNI}: a \code{data.frame} summarizing the estimated Minimum Number of
Individuals for the focal species, including the columns \code{species}, \code{MNI},
\code{alpha}, \code{dt}, and \code{min_prob}.
}

When \code{alpha_sensitivity} is not \code{NULL}, the function also performs a sensitivity
analysis of MNI across the supplied \code{alpha} values and generates a diagnostic
plot. In this plot:
\itemize{
\item The \strong{max_change_point} marks the range of \code{alpha} where the MNI
estimator is most sensitive to changes in spatial scale (i.e., where the
structure of the data “breaks” the most).

\item The \strong{saturation_point} marks a value of \code{alpha} beyond which
increasing \code{alpha} produces only small changes in MNI, indicating that the
curve is approaching a plateau. From this point onward, the assumed
connectivity is so high that most detections tend to be treated as distinct
individuals.
}
}
\description{
\code{assign_MNI_hmm()} assigns detections from camera-trap data to putative
individuals and estimates the Minimum Number of Individuals (MNI) for a focal
species. The function uses a discrete-time, discrete-space movement model:
movement between camera stations is governed by a transition matrix derived
from inter-station distances and a spatial scale parameter \code{alpha}, while
temporal dynamics are controlled by the time-step \code{dt}. For each new
detection, the function compares the probability that it belongs to an
existing individual against a minimum probability threshold (\code{min_prob});
detections with low assignment probability are treated as new individuals.
}
\details{
Optionally, a sensitivity analysis can be performed over a vector of \code{alpha}
values (\code{alpha_sensitivity}). In that case, the function repeatedly
recomputes the MNI for each \code{alpha} and generates diagnostic plots that
highlight where the estimator is most sensitive to spatial scale and where
it begins to saturate.
}
\examples{
\dontrun{
library(sf)

datab <- read.csv("sipecam_final.csv", header = TRUE)

Example1 <- event_independ(
  input             = datab,
  station_field     = "Station",
  species_field     = "Species",
  date_field        = "Date",
  date_format       = "\%d/\%m/\%Y",
  time_field        = "Time",
  independent_time  = 1,
  independent_units = "hours"
)

# Replace missing individual counts with 1 and keep a subset of columns
Example1$Individuos[is.na(Example1$Individuos)] <- 1
Example1 <- Example1[, c(1:2, 3:6, 9, 14:15, 20)]

test <- assign_MNI_hmm(
  data           = Example1,
  station_field  = "Carpeta",
  species_col    = "Species",
  date_field     = "Date",
  date_format    = "\%d/\%m/\%Y",
  time_field     = "Time",
  tz             = "UTC",
  species_filter = "Odocoileus virginianus",
  lat            = "Latitud",
  long           = "Longitud",
  alpha          = 300,                      # spatial scale (m)
  dt             = 1,                        # temporal step (hours)
  alpha_sensitivity = seq(200, 10000, 200),  # vector of alpha values
  min_prob       = 0.1
)
test
}
}
